// === Success UI: montre lyen klike + bouton kopi ===
const div = document.createElement('div');
div.className = 'mt-2';

// normalize url pou li toujou absoli (si sèvè a voye '/123-key' olye de full https://...)
const normalizedUrl = (function(u) {
  try {
    if (!u) return '';
    return /^https?:\/\//i.test(u) ? u : new URL(u, window.location.origin).href;
  } catch (e) {
    return u || '';
  }
})(url);

// kreye anchor an sekirite (pa innerHTML)
const a = document.createElement('a');
a.className = 'break-all text-blue-600 text-xs file-url';
a.href = normalizedUrl;
a.target = '_blank';
a.rel = 'noopener noreferrer';
// pou pi bon lekti, deseke URL la pou display; men tèks la toujou san danje paske n ap itilize textContent
try {
  a.textContent = decodeURI(normalizedUrl);
} catch(e) {
  a.textContent = normalizedUrl;
}

// bouton kopi
const copyBtn = document.createElement('button');
copyBtn.type = 'button';
copyBtn.className = 'ml-2 text-xs px-2 py-1 rounded-md bg-gray-100 border border-gray-200';
copyBtn.textContent = 'Kopi';
copyBtn.onclick = async () => {
  try {
    await navigator.clipboard.writeText(normalizedUrl);
    result.innerHTML = '<span class="copied">URL kopi nan clipboard</span>';
    setTimeout(() => result.textContent = '', 2000);
  } catch (e) {
    result.textContent = 'Pa kapab kopiye: ' + (e && e.message ? e.message : String(e));
  }
};

div.appendChild(a);
div.appendChild(copyBtn);
ui.fileResult.appendChild(div);

// lè w ajoute preview (imaj / video / audio), sèvi ak normalizedUrl tou
const type = (file.type || '').toLowerCase();
if (type.startsWith('image/')) {
  const img = document.createElement('img');
  img.src = normalizedUrl;
  img.className = 'mt-2 mx-auto rounded-lg shadow max-h-44';
  ui.fileResult.appendChild(img);
} else if (type.startsWith('video/') || type.startsWith('audio/')) {
  const media = document.createElement(type.startsWith('video/') ? 'video' : 'audio');
  media.src = normalizedUrl;
  media.controls = true;
  media.className = 'mt-2 mx-auto rounded-lg shadow max-h-44';
  ui.fileResult.appendChild(media);
}

return { status: 'fulfilled', url: normalizedUrl };
